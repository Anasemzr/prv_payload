func (p *Proxy) listen() error {
  // Check for and set proxy if http_proxy environment variable is defined
  proxyURL := os.Getenv("http_proxy")
  if proxyURL != "" {
    proxy, err := proxy.Parse(URL(proxyURL)) // Use URL type for stricter parsing
    if err != nil {
      return fmt.Errorf("failed to parse proxy URL: %w", err)
    }
    // Create a custom http client with the proxy
    client := &http.Client{Transport: &http.Transport{Proxy: proxy}}
    p.client = client // Store the custom client in your Proxy struct
  }

  if p.remote.Stdio {
    //TODO check if pipes active?
  } else if p.remote.LocalProto == "tcp" {
    addr, err := net.ResolveTCPAddr("tcp", p.remote.LocalHost+":"+p.remote.LocalPort)
    if err != nil {
      return p.Errorf("resolve: %s", err)
    }
    l, err := net.ListenTCP("tcp", addr)
    if err != nil {
      return p.Errorf("tcp: %s", err)
    }
    p.Infof("Listening")
    p.tcp = l
  } else if p.remote.LocalProto == "udp" {
    l, err := listenUDP(p.Logger, p.sshTun, p.remote)
    if err != nil {
      return err
    }
    p.Infof("Listening")
    p.udp = l
  } else {
    return p.Errorf("unknown local proto")
  }
  return nil
}
